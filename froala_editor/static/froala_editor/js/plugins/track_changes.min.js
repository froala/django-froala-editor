/*!
 * froala_editor v4.6.0 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2025 Froala Labs
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("froala-editor")):"function"==typeof define&&define.amd?define(["froala-editor"],t):t(e.FroalaEditor)}(this,function(z){"use strict";function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=Array(t);a<t;a++)n[a]=e[a];return n}function W(e){return function t(e){if(Array.isArray(e))return i(e)}(e)||function a(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function n(e,t){if(e){if("string"==typeof e)return i(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?i(e,t):void 0}}(e)||function r(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}z=z&&z.hasOwnProperty("default")?z["default"]:z,Object.assign(z.DEFAULTS,{trackChangesEnabled:!1,showChangesEnabled:!1}),z.PLUGINS.track_changes=function(P){var D=P.$;D.fn.isAfter=function(e){var t=D(this),a=t.parents(),n=e.parents(),r=t;for(var i in a){var s=e;if(a.hasOwnProperty(i)){var l=D(a[i]);for(var o in n)if(n.hasOwnProperty(o)){var c=D(n[o]);if(l[0]===c[0]){var d=r.index();return s.index()<d}s=c}r=l}}return!1};var u,r,s=[],K="",V="",B="",H="",b=[],i=[],S=null,Y=[],d=!1,F=!1;P.events.on("keydown",function(e){var t;if(!P.opts.trackChangesEnabled)return!0;var a=e.which,n=P.$el.find("table.fr-table-selected");if(n.length&&!P.keys.isArrow(a)&&a!==z.KEYCODE.TAB&&a!==z.KEYCODE.ALT&&a!==z.KEYCODE.ESC){if(e.ctrlKey||e.metaKey||a===z.KEYCODE.SHIFT)return;n.removeClass("fr-table-selected"),P.selection.get().collapse(n.get(0));var r=n.get(0);if(r&&r.parentNode){var i,s=null,l=a===z.KEYCODE.ENTER;if(k(n),r.nextSibling&&r.nextSibling.nodeType===Node.ELEMENT_NODE||e.which==z.KEYCODE.BACKSPACE||e.which==z.KEYCODE.DELETE)s=r.nextSibling;else{i=P.html.defaultTag();var o=(i=l?null:i)?"<".concat(i,' id="cursor-marker"></').concat(i,">"):' <br id="cursor-marker">';P.html.insert(o,!0,!0),s=P.$el.find("#cursor-marker").get(0)}if(s&&s.nodeType===Node.ELEMENT_NODE){var c=P.doc.createRange();c.selectNodeContents(s),c.collapse(!0);var d=P.selection.get();d.removeAllRanges(),d.addRange(c),s.removeAttribute("id")}}}if(u=null===(t=P.selection.get())||void 0===t||null===(t=t.focusNode)||void 0===t?void 0:t.nodeValue,P.helpers.isAndroid()){var g,h,f=P.selection.get();K=null==f||null===(g=f.focusNode)||void 0===g?void 0:g.nodeValue,V=null==f?void 0:f.focusNode,H=null===(h=V)||void 0===h?void 0:h.nextSibling,B=null==f?void 0:f.focusOffset}else if(function p(e){return(!P.keys.ctrlKey(e)||e.which!==z.KEYCODE.Z&&e.which!==z.KEYCODE.C)&&(48<=e.keyCode&&e.keyCode<=57||65<=e.keyCode&&e.keyCode<=90||97<=e.keyCode&&e.keyCode<=122||186<=e.keyCode&&e.keyCode<=222||13===e.keyCode||8===e.keyCode||32===e.keyCode||46===e.keyCode||96<=e.keyCode&&e.keyCode<=111)}(e))if(!P.keys.ctrlKey(e)||"b"!==e.key&&"i"!==e.key&&"u"!==e.key){if(P.keys.ctrlKey(e)&&"a"===e.key||P.keys.ctrlKey(e)&&"s"===e.key||P.keys.ctrlKey(e)&&"x"===e.key)return;F=F&&P.keys.ctrlKey(e)&&"v"===e.key,E(e)}else N()},!0),P.events.on("copy",function(e){if(!P.opts.trackChangesEnabled)return!0;var t=P.$el.find("table.fr-table-selected");F=!!t.length},!0),P.events.on("cut",function(e){if(!P.opts.trackChangesEnabled)return!0;for(var t=P.selection.get().getRangeAt(0).cloneContents(),a="",n="",r=0;r<t.childNodes.length;r++){var i=t.childNodes[r],s=i.outerHTML,l=i.textContent;i.nodeType===Node.TEXT_NODE&&(l=s=i.textContent.replace(/\u200B/g,"")),a+=s,n+=l}P.paste.saveCopiedText(a,n,!0),e.preventDefault();var o=P.$el.find("table.fr-table-selected");if(F=!!o.length,o.length){o.removeClass("fr-table-selected");var c=o.next().get(0);if(c){var d=P.doc.createRange();d.setStart(c,0),d.collapse(!0);var g=P.selection.get();g.removeAllRanges(),g.addRange(d)}else P.selection.get().collapse(o.get(0));P.track_changes.removedTable(o)}else E(e)},!0),P.events.on("keyup",function(e){if(!P.opts.trackChangesEnabled)return!0;var t;if(P.helpers.isMobile())if(r=null===(t=P.selection.get())||void 0===t||null===(t=t.focusNode)||void 0===t?void 0:t.nodeValue,d){for(var a=0;a<Y.length;a++)P.opts.showChangesEnabled&&D(Y[a].span).empty(),D(Y[a].span).prepend(Y[a]["delete"]);d=!(Y=[])}else if(P.helpers.isIOS()){for(var n=0;n<Y.length;n++)r&&1===r.length&&u&&1==u.length?(D(Y[n]["delete"]).attr("contenteditable","true"),D(Y[n]["delete"]).addClass("fr-ios-mobile-disable-select")):D(Y[n]["delete"]).attr("contenteditable","false");Y=[]}else{if(46===e.keyCode)return!0;E(e)}},!0),P.events.on("beforeinput",function(e){var t=e.originalEvent,a=!1;if(!P.opts.trackChangesEnabled)return!0;if(P.helpers.isAndroid()){var n=P.selection.get(),r=P.selection.ranges(0),i=r.startContainer,s=r.endContainer,l=D(i).parentsUntil(P.$el,"[data-tracking=true]"),o=D(s).parentsUntil(P.$el,"[data-tracking=true]");if("insertCompositionText"===t.inputType)if(""===t.data)a=!0;else if(n.toString().length>t.data.length){if(0<l.length||0<o.length)return d=!0,e.preventDefault(),!1;a=!0,e.composing=!0}if("insertText"!==t.inputType||P.selection.isCollapsed()||(a=!0),a||"deleteContentBackward"===t.inputType){var c;if(d=!0,i.lastChild&&!n.toString()&&null!==(c=i.lastChild.children)&&void 0!==c&&null!==(c=c.item(0))&&void 0!==c&&c.hasAttribute("contenteditable"))return;e.keyCode=8,e.deletion=!0,E(e)}}},!0),P.events.on("paste.before",function(e){P.opts.trackChangesEnabled&&P.helpers.isMobile()&&E(e)},!0),P.events.on("paste.after",function(e){if(P.opts.trackChangesEnabled){P.markers.insert();for(var t=P.$el.find(".fr-marker"),a=t.next();a.is("br");){var n=a.next();a.remove(),a=n}if(a.is("ul")||a.is("ol")){var r=t.closest("ul, ol"),i=a.children("li");i.find("[data-tracking=true]").add(i.closest("[data-tracking=true]")).addClass("fr-highlight-change");var s=0<a.closest("li").next().length?a.closest("li").next():function o(e){return e.append('<li data-temp-li="true"></li>').find("li").last()}(r);i.each(function(){var e=D(this),t="pending-".concat(P.id,"-").concat(P.track_changes.getPendingChanges().length),a=P.opts.showChangesEnabled?'class="fr-highlight-change"':"";D('<li><span data-tracking="true" data-track-id="'.concat(t,'" ').concat(a,">").concat(e.html(),"</span></li>")).insertBefore(s),P.track_changes.pushChange(t)});var l=r.find("li[data-temp-li=true");0<l.length&&l.remove(),a.remove()}P.markers.remove()}},!0),P.events.on("image.inserted",function(e){P.helpers.isMobile()&&P.opts.trackChangesEnabled&&e.data("tracking-img",!0)}),P.events.on("image.removed",function(e){if(P.helpers.isMobile()&&P.opts.trackChangesEnabled&&!e.data("tracking-img")&&!e.parent().data("tracking")){var t=P.selection.ranges(0).startContainer,a=D(t).parentsUntil(P.$el,"[data-tracking=true]");P.markers.insert();var n=P.$el.find(".fr-marker"),r="pending-".concat(P.id,"-").concat(P.track_changes.getPendingChanges().length),i=P.opts.showChangesEnabled?'class="fr-highlight-change"':"",s=D('<span data-tracking="true" data-track-id="'.concat(r,'" ').concat(i,"></span>")),l=D('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false"></span>');P.opts.showChangesEnabled||l.addClass("fr-track-hide"),e.data("tracking-img",!0),D(t).data("tracking")||a.length?(D(n).replaceWith(l),D(l).append(e),P.markers.remove()):(D(n).replaceWith(s),D(s).prepend(l),D(l).append(e),P.markers.remove(),P.track_changes.pushChange(r))}}),P.events.on("commands.before",function(t){if(!P.opts.trackChangesEnabled)return!0;var e=["applytextColor","bold","italic","underline","strikeThrough","subscript","superscript","fontFamily","fontSize","textColor","applybackgroundColor","inlineClass","inlineStyle","alignLeft","alignCenter","formatOLSimple","alignRight","alignJustify","formatOL","formatUL","paragraphFormat","paragraphStyle","lineHeight","outdent","indent","quote"];if(["change","applyAll","applyLast","removeLast","showChanges","trackChanges","moreTrackChanges","undo","redo","fullscreen","print","getPDF","spellChecker","selectAll","html","help"].filter(function(e){return e===t}).length||e.filter(function(e){return e===t}).length){if(e.filter(function(e){return e===t}).length&&"paragraphFormat"!==t&&"paragraphStyle"!==t&&"lineHeight"!==t)N(t);else if("paragraphFormat"===t||"paragraphStyle"===t||"lineHeight"===t){P.selection.save();for(var a=P.$el.find('.fr-marker[data-type="true"]').length&&P.$el.find('.fr-marker[data-type="true"]').get(0),n=P.opts.showChangesEnabled?'class="fr-highlight-change"':"",r="pending-".concat(P.id,"-").concat(P.track_changes.getPendingChanges().length),i=D('<span data-tracking="true" data-track-id="'.concat(r,'" ').concat(n,"></span>")),s=D('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false" style="display:none"></span>'),l=a.parentNode.cloneNode(!0),o=l.childNodes,c=0;c<o.length;)o[c].className&&"fr-marker"===o[c].className?o[c].remove():c++;D(s).append(l),D(i).append(s),D(a.parentNode).after(D("<p></p>")),D(a.parentNode.nextSibling).append(i),i=D('<span data-tracking="true" data-track-id="'.concat(r,'" ').concat(n,"></span>")),D(a.parentNode.nextSibling).after(D("<p></p>")),D(a.parentNode.nextSibling.nextSibling).append(i),i.append(a.parentNode),P.track_changes.pushChange(r),P.selection.restore()}}else{if(z.COMMANDS[t]&&(z.COMMANDS[t].hasOwnProperty("type")&&"dropdown"===z.COMMANDS[t].type||z.COMMANDS[t].more_btn||z.COMMANDS[t].popup)){if("insertImage"!=t&&"insertFile"!=t)return}else if("clearFormatting"===t){if(P.opts.trackChangesEnabled){S=P.selection.blocks();for(var d=[],g=0,h=0;h<S.length;h++){g=h<g?g:h;var f=D(S[h]);if(f.is("li"))f.siblings("li").each(function(e,t){D(t).find("li").length&&(d.push({index:g,item:t}),g+=1)});b[h]=D("<span>".concat(f.get(0).innerHTML,"</span>"))}for(var p=0,u=d;p<u.length;p++){var k=u[p],v=k.index,m=k.item,C=D(D(m).get(0).outerHTML);C.find("ul").remove(),C.find("ol").remove(),b=[].concat(W(b.slice(0,v+1)),[D("<span>".concat(C.get(0).innerHTML,"</span>"))],W(b.slice(v+1))),S=[].concat(W(S.slice(0,v+1)),[m],W(S.slice(v+1)))}}return}E()}},!0),P.events.on("commands.after",function(e){if(!P.opts.trackChangesEnabled)return!0;if(0<=["undo","redo"].indexOf(e))!function r(){var e=P.$el.find("[data-tracking=true]");s.splice(0,s.length);for(var t=0;t<e.length;t++){var a=D(e.get(t)).data("track-id");s[a.slice(a.lastIndexOf("-")+1)]=a}}();else if("clearFormatting"==e&&P.opts.trackChangesEnabled){var t="pending-".concat(P.id,"-").concat(P.track_changes.getPendingChanges().length);for(var a in S){var n=D(S[a]);b[a]&&(p(n,b[a],t),b[a]=null,i[a]=null)}P.track_changes.pushChange(t),b=[],S=null}},!0),P.events.on("quickInsert.commands.before",function(e){P.opts.trackChangesEnabled&&E(e)}),P.events.on("findandreplace.beforeOnReplace",function(e){if(P.opts.trackChangesEnabled){var t=P.$el.find(".fr-find-replace-current-highlight").get(0),a=P.doc.createRange();a.selectNodeContents(t);var n=P.selection.get();n.removeAllRanges(),n.addRange(a),P.selection.save(),P.$el.get(0).querySelectorAll(".fr-find-replace-current-highlight").forEach(function(e){e.classList.remove("fr-find-replace-current-highlight"),e.classList.remove("fr-find-replace-highlight")}),E(e),P.markers.insert()}});var l=null,o=!1,c=null;function g(e){var t=null;if("undefined"!=typeof P.doc.caretPositionFromPoint){var a=P.doc.caretPositionFromPoint(e.clientX,e.clientY);t={offsetNode:a.offsetNode,offset:a.offset}}else if("undefined"!=typeof P.doc.caretRangeFromPoint){var n=P.doc.caretRangeFromPoint(e.clientX,e.clientY);t={offsetNode:n.startContainer,offset:n.startOffset}}return t}function h(){return s.pop()}function E(e){var t=!(!e||8!=e.keyCode),a=e&&13==e.keyCode,n=!(!e||46!=e.keyCode);if(P.opts.trackChangesEnabled){P.selection.restore(),e&&e.composing&&(P.selection.save(),P.selection.ranges()[0].collapse(!1));var r=P.selection.ranges(0),i=r.startContainer,s=!1,l=t&&0===r.startOffset&&P.$el.get(0).firstChild===i;if(t&&0===r.startOffset&&P.$el.get(0).firstChild!==i&&i!==document){for(var o=G(i);o&&o.nodeType===Node.TEXT_NODE&&1===o.length&&8203===o.textContent.charCodeAt(0);)o=G(o);o&&(i=o,s=!0)}var c=D(i).parentsUntil(P.$el,"[data-tracking=true]");if(D(i).data("tracking")&&t){P.markers.insert();var d=P.$el.find(".fr-marker");return d[0].previousSibling&&"IMG"===d[0].previousSibling.tagName||P.selection.clear(),void D(d).remove()}if(!c.length||D(i).data("tracking-deleted")&&t||"TD"==i.tagName||a){if(P.selection.isCollapsed()){if(s){var g=i;if(g&&g.nodeType!==Node.TEXT_NODE&&0<g.childNodes.length){for(var h=null,f=g.childNodes.length-1;0<=f;f--)if(g.childNodes[f].nodeType===Node.TEXT_NODE){h=g.childNodes[f];break}null!==h&&(g=h)}var p=r.cloneRange();p.setStart(g,g.length),p.setEnd(g,g.length),P.selection.get().removeAllRanges(),P.selection.get().addRange(p)}!s&&l||e&&"drop"===e.type&&0<P.$el.find(".fr-marker").length||P.markers.insert();var u=P.$el.find(".fr-marker");if(e&&e.composing&&(u=D(u[1])),!u.length)return;var k="pending-".concat(P.id,"-").concat(P.track_changes.getPendingChanges().length),v=P.opts.showChangesEnabled?'class="fr-highlight-change"':"";if(t||n){if(t){if(!u[0].previousSibling||u[0].previousSibling.nodeType!==Node.ELEMENT_NODE||!u[0].previousSibling.lastChild||u[0].previousSibling.lastChild.nodeType!==Node.ELEMENT_NODE||"IMG"!==u[0].previousSibling.lastChild.tagName){for(;D(u[0].previousSibling).data("tracking");)u.insertBefore(u.prev());D(u[0].previousSibling).find("[data-tracking=true]").length&&u.insertBefore(D(u[0].previousSibling).find("[data-tracking=true]").eq(0))}}else if(D(i).data("tracking")){if(!i.nextSibling)return void(u[0].nextSibling&&"IMG"===u[0].nextSibling.tagName&&u[0].nextSibling.remove());u.insertBefore(i.nextSibling),U(u)}else U(u);var m=u[0]&&u[0].previousSibling?u[0].previousSibling.nodeValue:"",C=m&&m.slice(0,-(e.selectionLength?e.selectionLength:1));n&&(u[0].nextSibling&&"SPAN"!==u[0].nextSibling.tagName&&null===u[0].nextSibling.nodeValue&&u[0].nextSibling.firstChild&&u[0].nextSibling.firstChild.before(u[0]),C=(m=u[0].nextSibling?u[0].nextSibling.nodeValue:" ")&&m.slice(1)),n&&u[0].nextSibling&&"isPasted"===u[0].nextSibling.id?C=(m=u[0].nextSibling?u[0].nextSibling.textContent:" ")&&m.slice(1):t&&u[0].previousSibling&&"isPasted"===u[0].previousSibling.id&&(C=(m=u[0].previousSibling?u[0].previousSibling.textContent:" ")&&m.slice(0,-(e.selectionLength?e.selectionLength:1)));var b,S=D('<span data-tracking="true" data-track-id="'.concat(k,'" ').concat(v,"></span>")),E=D('<span data-tracking-deleted="true" class="fr-tracking-deleted" '.concat(P.helpers.isIOS()?"":'contenteditable="false"',"></span>"));P.opts.showChangesEnabled||(P.helpers.isMobile()?E.addClass("fr-track-hide-mobile"):E.addClass("fr-track-hide"));var N=!1,y=!1;if(t)try{var A=u[0]&&u[0].previousSibling;if(u[0]&&u[0].previousElementSibling&&"I"===u[0].previousElementSibling.tagName&&!m&&(b=u[0].previousElementSibling),A&&3===A.nodeType&&"SPAN"!==A.parentNode.tagName&&A.previousSibling&&"SPAN"===A.previousSibling.tagName&&" "===A.nodeValue&&0<D(A.previousSibling).find(".fr-emoticon").length?b=A.previousSibling:A&&"SPAN"===A.parentNode.tagName&&0<D(A.parentNode).find(".fr-emoticon").length?(b=A.parentNode,N=!0):A&&("SPAN"===A.tagName&&"isPasted"!==A.id||"HR"===A.tagName)?b=A:D(u).parent().prev().is("hr")?(b=D(u).parent().prev().get(0),N=y=!0):A&&"IMG"===A.tagName&&(b=A,D(S).prepend("".concat(z.MARKERS)),D(S).append("".concat(z.MARKERS))),P.helpers.isMobile()&&u[0]&&!b&&!m&&!C)return;N?(D(u[0].parentNode).after(S),y?D(u).parent().remove():D(u).remove()):u[0]?e.composing?D(u).after(S):D(u).before(S):D(H).before(S)}catch(e){H&&D(H).before(S)}else if(n){var x=u[0].nextSibling;u[0].nextElementSibling&&"I"===u[0].nextElementSibling.tagName&&!u[0].nextSibling.nodeValue?b=u[0].nextElementSibling:x&&3===x.nodeType&&"SPAN"!==x.parentNode.tagName&&x.nextSibling&&"SPAN"===x.nextSibling.tagName&&" "===x.nodeValue&&0<D(x.nextSibling).find(".fr-emoticon").length?b=x.nextSibling:x&&"SPAN"===x.parentNode.tagName&&0<D(x.parentNode).find(".fr-emoticon").length?(b=x.parentNode,N=!0):x&&"SPAN"===x.tagName&&u[0].nextSibling&&"isPasted"!==u[0].nextSibling.id?b=x:x&&"IMG"===x.tagName&&(b=x,D(S).prepend("".concat(z.MARKERS)),D(S).append("".concat(z.MARKERS))),N?(D(u[0].parentNode).before(S),D(u).remove()):D(u).after(S)}if(e.composing?Y.push({span:S,"delete":E}):(P.helpers.isIOS()&&Y.push({"delete":E}),D(S).prepend(E)),!b&&(b=m&&m.replace(C,""),P.helpers.isMobile()&&K&&!e.composing)){var T=P.selection.get().focusNode,_=P.selection.get().focusOffset,M=1;V&&T&&V.isSameNode(T)&&(M=B-_),b=K.replace(/\u00a0/g," ").replace(m.replace(/\u00a0/g," "),"").slice(0,M)}if(b&&(N?(D(E).append(D(D(b).get(0).outerHTML)),P.markers.insert()):D(E).append(b)),b&&0==b.length)return;P.browser.msie&&t&&(D(S).prepend("".concat(z.MARKERS)),D(S).append("".concat(z.MARKERS))),t&&(C||""===C)&&u[0].previousSibling?u[0].previousSibling.nodeValue=C:n&&(D(S).append("".concat(z.MARKERS)),u[0].nextSibling.nodeValue=C)}else{var R=z.INVISIBLE_SPACE;if(e&&P.helpers.isMobile()&&((R=u[0]&&u[0].previousSibling&&u[0].previousSibling.nodeValue?u[0].previousSibling.nodeValue.slice(-1):z.INVISIBLE_SPACE)&&u[0]&&u[0].previousSibling&&u[0].previousSibling.nodeValue?u[0].previousSibling.nodeValue=u[0].previousSibling.nodeValue.slice(0,-1):!u[0]||u[0].previousSibling||u[0].nextSibling||R!==z.INVISIBLE_SPACE||(R=P.selection.get().focusNode.nodeValue.slice(B,P.selection.get().focusOffset),P.selection.get().focusNode.nodeValue=P.selection.get().focusNode.nodeValue.slice(P.selection.get().focusOffset))),a){if(u.parent().parent().is("li"))return;var w=D("<p></p>");return void(0<u.closest("p").length&&(u.closest("p").after(w),w.append(u),P.markers.remove(),setTimeout(function(){w.prev().text()!==String.fromCharCode(8203)&&""!==w.prev().text()||w.prev().remove(),P.selection.setAfter(w[0])},1)))}if(u[0].previousSibling&&"BR"===u[0].previousSibling.tagName&&u[0].previousSibling.remove(),F&&u[0].parentNode&&"DIV"!=u[0].parentNode.tagName){var I=P.doc.createElement("div");I.innerHTML='<span data-tracking="true" data-track-id="'.concat(k,'" ').concat(v,">").concat(z.MARKERS,"</span>"),D(I.firstChild).addClass("fr-highlight-table"),u.replaceWith(I),F=!1}else u.replaceWith('<span data-tracking="true" data-track-id="'.concat(k,'" ').concat(v,">").concat(R+z.MARKERS,"</span>"))}P.selection.restore(),P.track_changes.pushChange(k)}else{P.selection.save();var L=P.$el.find('.fr-marker[data-type="true"]').length&&P.$el.find('.fr-marker[data-type="true"]').get(0),$=P.$el.find('.fr-marker[data-type="false"]').length&&P.$el.find('.fr-marker[data-type="false"]').get(0);if(D(L).parent().hasClass("fr-emoticon")&&D(L).parent().before(L),D(L).isAfter(D($))){var O=L;L=$,$=O}j(L,$,e&&e.deletion),P.selection.restore()}P.helpers.isMobile()&&K&&P.markers.remove()}}}function U(e){if(D(e[0].nextSibling).data("tracking")){for(;D(e[0].nextSibling).data("tracking")&&(!(0<D(e[0].previousElementSibling).find("[data-tracking-deleted=true]").length&&0<D(e[0].nextElementSibling).find("[data-tracking-deleted=true]").length)||D(e[0].previousSibling).data("tracking"));)D(e).insertAfter(e.next());e.insertBefore(e[0].previousSibling)}}function G(e){var t=e.previousSibling;if(!t){var a=D(e).parent().get(0).previousSibling;null!==a&&(t=a.lastChild||a)}return t}function j(e,t){var a=2<arguments.length&&arguments[2]!==undefined&&arguments[2];if(e&&(!e.isSameNode(t)||!D(e).hasClass("fr-marker"))){for(;e.nodeType===Node.COMMENT_NODE;)e=e.nextSibling;if(D(e).parent().is("table")&&0!==D(e).parent().next().text().length&&j(D(e).parent().next()[0],t,a),"TD"!==e.tagName||1!==e.childNodes.length||"BR"!==e.childNodes[0].tagName){if(P.node.isBlock(e)&&"HR"!==e.tagName)return P.node.hasClass(e.firstChild,"fr-marker")?j(e.firstChild.nextSibling,t,a):j(e.firstChild,t,a),!1;if("BR"===e.tagName&&"TD"===e.parentElement.tagName){var n=e.parentElement.nextElementSibling;D(e).remove(),j(n,t)}var r="pending-".concat(P.id,"-").concat(P.track_changes.getPendingChanges().length),i=P.opts.showChangesEnabled?'class="fr-highlight-change"':"",s=D('<span data-tracking="true" data-track-id="'.concat(r,'" ').concat(i,"></span>")),l=D('<span data-tracking-deleted="true" class="fr-tracking-deleted" '.concat(P.helpers.isIOS()?"":'contenteditable="false"',"></span>"));P.opts.showChangesEnabled||(P.helpers.isMobile()?l.addClass("fr-track-hide-mobile"):l.addClass("fr-track-hide"));var o=e;for(D(e).before(s),P.track_changes.pushChange(r);o&&D(o).hasClass("fr-marker");)o=o.nextSibling;for(var c=!1;o&&!c&&!D(o).hasClass("fr-marker")&&!D(o).is("[data-track-id]")&&0===D(o).find("fr-marker").length&&"UL"!==o.tagName&&"OL"!==o.tagName;){var d=o;if("IMG"===o.tagName&&D(o).data("tracking-img","true"),P.node.isBlock(o)&&"HR"!==e.tagName)return j(o.firstChild,t,a),!1;if(o)for(var g=o.childNodes,h=0;h<g.length;h++)if(g[h].className&&"fr-marker"===g[h].className){c=!0,j(o.firstChild,t,a);break}c||(o=o.nextSibling,D(l).append(d))}if(!o||"UL"!==o.tagName&&"OL"!==o.tagName||j(o,t,a),a?Y.push({span:s,"delete":l}):(P.helpers.isIOS()&&Y.push({"delete":l}),D(s).prepend(l)),P.browser.msie?D(s).prepend("".concat(z.INVISIBLE_SPACE+z.MARKERS)):D(s).prepend("".concat(z.INVISIBLE_SPACE)),D(s).append("".concat(z.INVISIBLE_SPACE+z.MARKERS)),!o&&!e.isSameNode(t)){for(var f=s.get(0).parentNode;f&&!f.nextSibling&&!P.node.isElement(f);)f=f.parentNode;if(f){var p=f.nextSibling;p&&(P.node.isBlock(p)?"HR"===p.tagName?j(p.nextSibling,t,a):(P.browser.mozilla&&"LI"===f.tagName&&"SPAN"===f.lastChild.tagName&&D(f.lastChild).hasClass("fr-marker")&&f.lastChild.remove(),j(p.firstChild,t,a)):j(p,t,a))}}}}}function N(e){if(P.opts.trackChangesEnabled){P.selection.restore();var t=P.selection.ranges(0).startContainer,a=D(t).parentsUntil(P.$el,"[data-tracking=true]");if(D(t).data("tracking"))return;if(!a.length&&!P.selection.isCollapsed()&&"quote"!=e){P.selection.save(),f(P.$el.find('.fr-marker[data-type="true"]').length&&P.$el.find('.fr-marker[data-type="true"]').get(0),P.$el.find('.fr-marker[data-type="false"]').length&&P.$el.find('.fr-marker[data-type="false"]').get(0));var n=P.$el.find('.fr-marker[data-type="true"]').length&&P.$el.find('.fr-marker[data-type="true"]').get(0),r=n.parentNode;if(r&&"A"===r.tagName&&r.firstChild&&"SPAN"===r.firstChild.tagName&&2<r.firstChild.childNodes.length&&"STRONG"===r.firstChild.childNodes[3].tagName)D(r.firstChild.childNodes[3].firstChild).before(n);else{for(var i=n.previousSibling.firstChild;i&&"SPAN"!==i.tagName;)i=i.nextSibling;D(i).after(n)}P.selection.restore()}}}function f(e,t,a){if(e&&!("<br>"===D(e).html()&&D(e).parent().is("td")||(D(e).parent().is("table")&&0!==D(e).parent().next().text().length&&f(D(e).parent().next()[0],t,a),D(e).is("br")&&D(e).parent().length&&D(e).parent().is("td")&&0===D(e).parent().text().length))){for(a||(a="pending-".concat(P.id,"-").concat(P.track_changes.getPendingChanges().length),P.track_changes.pushChange(a));e.nodeType===Node.COMMENT_NODE;)e=e.nextSibling;if(P.node.isBlock(e)&&"HR"!==e.tagName)return P.node.hasClass(e.firstChild,"fr-marker")?f(e.firstChild.nextSibling,t,a):f(e.firstChild,t,a),!1;var n=P.opts.showChangesEnabled?'class="fr-highlight-change"':"",r=D('<span data-tracking="true" data-track-id="'.concat(a,'" ').concat(n,"></span>")),i=D('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false" style="display:none"></span>'),s=e;for(D(e).before(r);s&&D(s).hasClass("fr-marker");)s=s.nextSibling;for(var l=!1;s&&!l&&!D(s).hasClass("fr-marker")&&0===D(s).find("fr-marker").length&&"UL"!==s.tagName&&"OL"!==s.tagName;){var o=s;if(P.node.isBlock(s)&&"HR"!==e.tagName)return f(s.firstChild,t,a),!1;if(s)for(var c=s.childNodes,d=0;d<c.length;d++)if(c[d].className&&"fr-marker"===c[d].className){l=!0,f(s.firstChild,t,a);break}l||(s=s.nextSibling,D(i).append(o.cloneNode(!0)),D(r).append(o))}if(!s||"UL"!==s.tagName&&"OL"!==s.tagName||f(s,t,a),D(s).hasClass("fr-marker")&&D(r).append(s),D(r).prepend(i),D(r).prepend("".concat(z.INVISIBLE_SPACE)),D(r).append("".concat(z.INVISIBLE_SPACE)),!s&&!e.isSameNode(t)){for(var g=r.get(0).parentNode;g&&!g.nextSibling&&!P.node.isElement(g);)g=g.parentNode;if(g){var h=g.nextSibling;h&&(P.node.isBlock(h)?"HR"===h.tagName?f(h.nextSibling,t,a):f(h.firstChild,t,a):f(h,t,a))}}}}function a(e){var t=D('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false"></span>');return P.opts.showChangesEnabled||(P.helpers.isMobile()?t.addClass("fr-track-hide-mobile"):t.addClass("fr-track-hide")),t.append(e),t}function n(e,t){var a="pending-".concat(P.id,"-").concat(P.track_changes.getPendingChanges().length),n=P.opts.showChangesEnabled?'class="fr-highlight-change"':"",r=D('<span data-tracking="true" data-track-id="'.concat(a,'" ').concat(n,"></span>"));t&&r.addClass(t);var i=D('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false"></span>');return P.opts.showChangesEnabled||i.addClass("fr-track-hide"),e.before(r),r.append(e),P.track_changes.pushChange(a),r}function k(e){var t=!1;if(e.find("[data-tracking=true]").each(function(){var e=this.innerText.replace(/\u200B/g,"");0<e.length&&"\n"!=e&&(t=!0)}),t)alert("Your table has pending changes. Please resolve them before remove table.");else{var r="pending-".concat(P.id,"-").concat(P.track_changes.getPendingChanges().length),i=P.opts.showChangesEnabled?'class="fr-highlight-change"':"",a=D('<div><span data-tracking="true" data-track-id="'.concat(r,'" ').concat(i,"></span></div>")),n=a.find("span").first(),s=D('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false"></span>');e.before(a.get(0)),e.find("tr").find("> td").each(function(){var e=D('<span data-tracking="true" data-track-id="'.concat(r,'" ').concat(i,"></span>")),t=D('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false"></span>'),a=D(this),n=a[0].innerText;D(t)[0].innerText=n,a[0].innerText="",e.prepend(t),a.prepend(e)}),P.opts.showChangesEnabled||s.addClass("fr-track-hide"),s.append(e),n.append(s),P.track_changes.pushChange(r)}}function p(e,t,a){var n=P.opts.showChangesEnabled?'class="fr-highlight-change"':"",r=D('<span data-tracking="true" data-track-id="'.concat(a,'" ').concat(n,"></span>")),i=D('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false"></span>');P.opts.showChangesEnabled||i.addClass("fr-track-hide"),i.append(t.get(0).innerHTML),r.append(i);var s=e.get(0).innerHTML;e.html(""),e.append(r),r.append(s)}function v(){if(P.events.trigger("image.hideResizer"),P.events.trigger("video.hideResizer"),P.html.cleanEmptyTags(!0),P.helpers.isMobile())for(var e=P.$el.find("img[data-tracking-img]"),t=0;t<e.length;t++){var a=D(e.get(t));a.parent()&&a.parent().data("tracking")||a.removeData("tracking-img")}}function e(){P.$el.find("li").each(function(){0===this.innerText.replace(/\u200B/g,"").length&&this.remove()})}function t(){var e=h();if(e){var t,a=P.$el.find("[data-track-id=".concat(e,"]"));if(a.length){var n=a.parent("a");if(n.length){var r=D(n.get(0).outerHTML).text();1===[].filter.call(r,function(e){return 8203!==e.charCodeAt(0)}).length&&(t=n)}for(var i=0;i<a.length;i++){var s=a.get(i),l=D(a).data("tracking-deleted")?D(a):D(s).find("[data-tracking-deleted=true]");l.length&&(l.get(0).remove?l.get(0).remove():l.get(0).parentNode.removeChild(l.get(0))),s.hasAttribute("style")?(D(s).removeData("tracking"),D(s).removeData("track-id"),D(s).removeClass("fr-highlight-change")):(P.selection.save(),0<D(s).find("IFRAME").length?(D(s).removeData("tracking"),D(s).removeData("track-id"),D(s).removeClass("fr-highlight-change")):s.outerHTML=s.innerHTML,P.selection.restore())}}t&&t.remove()}v()}function m(){var e=h();if(e){var t=P.$el.find("[data-track-id=".concat(e,"]"));if(t.length){P.selection.save();for(var a=t.length-1;0<=a;a--){var n=D(t).data("tracking-deleted")?D(t):D(t.get(a)).find("[data-tracking-deleted=true]");if(n.length)if(0<D(t).find("IFRAME").length)D(t).removeData("tracking"),D(t).removeData("track-id"),D(t).removeClass("fr-highlight-change"),D(t).removeClass("fr-tracking-deleted"),D(t).removeData("tracking-deleted"),D(t).removeAttr("contenteditable");else n.parent("[data-tracking=true]").data("track-id")==e?(D(t.get(a)).find("[data-tracking-deleted=true]").remove(),t.get(a).outerHTML=n.get(0).innerHTML):t.get(a).remove?t.get(a).remove():t.get(a).parentNode.removeChild(t.get(a));else t.get(a).remove?t.get(a).remove():t.get(a).parentNode.removeChild(t.get(a))}P.selection.restore()}}v()}return P.events.on("drop",function(e){if(P.opts.trackChangesEnabled){var t=g(e),a=P.selection.ranges(0);if(t&&P.$el.contains(t.offsetNode)&&P.selection.inEditor()&&a&&(a.startContainer===t.offsetNode&&a.startOffset===t.offset||a.endContainer===t.offsetNode&&a.endOffset===t.offset||a.startContainer===t.offsetNode&&a.endContainer===t.offsetNode&&t.offset>=a.startOffset&&t.offset<=a.endOffset))return;var n=D(e.target);if(n.hasClass("fr-highlight-change")&&n.children(".fr-tracking-deleted").length)return e.preventDefault(),e.stopPropagation(),!1;if(e.originalEvent.dataTransfer&&0===e.originalEvent.dataTransfer.items.length&&0===e.originalEvent.dataTransfer.files.length)return;P.undo.saveStep();var r=P.track_changes.getPendingChanges().length;E(e),r!==P.track_changes.getPendingChanges().length&&(o=!0,c=P.id),l=e}},!0),P.events.on("paste.beforeCleanup",function(e){if(P.opts.trackChangesEnabled&&l){var t=D(g(l).offsetNode).parentsUntil(P.$el,'[data-tracking="true"]');return o&&c===P.id&&0===t.length&&h(),E(l),l=null,o=!1,e}},!0),P.events.on("element.beforeDrop",function(e){if(P.opts.trackChangesEnabled){var t=n(a(e.clone()));e.after(t),o=!0,c=P.id}},!0),P.events.on("element.dropped",function(e){P.opts.trackChangesEnabled&&(o&&c===P.id&&(h(),o=!1,c=null),n(e),l=null)},!0),{toggleTracking:function C(){P.opts.trackChangesEnabled&&-1<P.html.get(!0,!0).indexOf("data-tracking")||P.opts.trackChangesEnabled&&0<P.$el.find("[data-tracking=true]").length?alert("Your editor has pending changes. Please resolve them before turning off Track Changes in the toolbar."):(P.commands.moreTrackChanges(),P.opts.trackChangesEnabled=!P.opts.trackChangesEnabled,P.opts.trackChangesEnabled||(P.opts.showChangesEnabled=!1))},pushChange:function y(e){s.push(e)},insertChangeAt:function A(e,t){s=[].concat(W(s.slice(0,e)),[t],W(s.slice(e)))},popChange:h,getPendingChanges:function x(){return s},showChanges:function T(){if(P.opts.showChangesEnabled=!P.opts.showChangesEnabled,function r(e,t){for(var a=0;a<e.length;a++)t?(D(e.get(a)).removeClass("fr-track-hide"),D(e.get(a)).removeClass("fr-track-hide-mobile")):P.helpers.isMobile()?D(e.get(a)).addClass("fr-track-hide-mobile"):D(e.get(a)).addClass("fr-track-hide")}(P.$el.find(".fr-tracking-deleted"),P.opts.showChangesEnabled),P.opts.showChangesEnabled)for(var e=P.$el.find("[data-tracking=true]").not(".fr-highlight-change"),t=0;t<e.length;t++)D(e.get(t)).addClass("fr-highlight-change");else for(var a=P.$el.find(".fr-highlight-change"),n=0;n<a.length;n++)D(a.get(n)).removeClass("fr-highlight-change")},acceptAllChanges:function _(){for(;0!=P.track_changes.getPendingChanges().length;)t();s=[],e(),P.$el.find("li").each(function(){!D(this).children()[0]||"OL"!==D(this).children()[0].tagName&&"UL"!==D(this).children()[0].tagName||e()})},rejectAllChanges:function M(){for(;0!=P.track_changes.getPendingChanges().length;)m();s=[]},acceptSingleChange:t,rejectSingleChange:m,refresh:function R(e){var t,a,n=P.$el.find("[data-tracking=true]");e.toggleClass("fr-disabled",!s.length),e.toggleClass("fr-active",s.length).attr("aria-pressed",s.length),0<!n.length&&(e.removeClass("fr-active"),e.addClass("fr-disabled"));var r=null===(t=P.$tb)||void 0===t?void 0:t.find('.fr-command[data-cmd="markdown"]');r&&P.opts.trackChangesEnabled?r.addClass("fr-disabled"):r&&!D(".fr-active.fr-popup").length&&r.removeClass("fr-disabled");var i=null===(a=P.$tb)||void 0===a?void 0:a.find('.fr-command[data-cmd="showChanges"]');i&&P.opts.trackChangesEnabled&&i.removeClass("fr-disabled")},replaceSpecialItem:function w(e){P.selection.setBefore(e.get(0)),P.selection.setAfter(e.get(0)),f(P.$el.find('.fr-marker[data-type="true"]').length&&P.$el.find('.fr-marker[data-type="true"]').get(0),P.$el.find('.fr-marker[data-type="false"]').length&&P.$el.find('.fr-marker[data-type="false"]').get(0))},removeSpecialItem:function I(e){P.selection.setBefore(e.get(0)),P.selection.setAfter(e.get(0)),j(P.$el.find('.fr-marker[data-type="true"]').length&&P.$el.find('.fr-marker[data-type="true"]').get(0),P.$el.find('.fr-marker[data-type="false"]').length&&P.$el.find('.fr-marker[data-type="false"]').get(0))},removedTable:k,addQuote:function L(e){var t="pending-".concat(P.id,"-").concat(P.track_changes.getPendingChanges().length),a=P.opts.showChangesEnabled?'class="fr-highlight-change"':"",n=D('<div data-tracking="true" data-track-id="'.concat(t,'" ').concat(a,"></div>")),r=D('<div data-tracking="true" data-track-id="'.concat(t,'" ').concat(a,"></div>")),i=D('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false"></span>');P.opts.showChangesEnabled||i.addClass("fr-track-hide"),e.before(r),e.before(n);var s=e.get(0).innerHTML;i.append(s),n.append(i),r.append(e),r.find('[data-tracking="true"]').each(function(e,t){D(t).children().eq(0).insertBefore(D(t)),D(t).remove()}),P.track_changes.pushChange(t)},removeQuote:function $(e,t){if(!(0<t)){var a="pending-".concat(P.id,"-").concat(P.track_changes.getPendingChanges().length),n=P.opts.showChangesEnabled?'class="fr-highlight-change"':"",r=D('<div data-tracking="true" data-track-id="'.concat(a,'" ').concat(n,"></div>")),i=D('<div data-tracking="true" data-track-id="'.concat(a,'" ').concat(n,"></div>")),s=D('<span data-tracking-deleted="true" class="fr-tracking-deleted" contenteditable="false"></span>');P.opts.showChangesEnabled||s.addClass("fr-track-hide"),e.before(i),e.before(r);var l=e.find("blockQuote").eq(0).html();l||(l=e.html()),s.append(e),r.append(s),i.append(l),i.find('[data-tracking="true"]').each(function(e,t){D(t).children().eq(0).insertBefore(D(t)),D(t).remove()}),P.track_changes.pushChange(a)}},wrapInTracking:n,wrapInDelete:a,wrapLinkInTracking:function O(e,t){var a="pending-".concat(P.id,"-").concat(P.track_changes.getPendingChanges().length),n=P.opts.showChangesEnabled?'class="fr-highlight-change"':"",r=D('<span data-tracking="true" data-track-id="'.concat(a,'" ').concat(n,"></span>"));return e.before(r),r.append(e),P.track_changes.insertChangeAt(t-1,a),r},pasteInEmptyEdior:function q(e){var t=P.$el.find(".fr-highlight-change");D(t)[0].style.display="block",D(t)[0].innerHTML=e},pasteInEdior:function X(e){var t=P.$el.find(".fr-marker");D(t)[0].outerHTML=e,P.markers.remove()}}},z.DefineIcon("trackChanges",{NAME:"enable-tracking",SVG_KEY:"trackChanges"}),z.DefineIcon("showChanges",{NAME:"show-changes",SVG_KEY:"showTrackChanges"}),z.DefineIcon("applyAll",{NAME:"apply-all",SVG_KEY:"acceptAllChanges"}),z.DefineIcon("removeAll",{NAME:"remove-all",SVG_KEY:"rejectAllChanges"}),z.DefineIcon("applyLast",{NAME:"apply-last",SVG_KEY:"acceptSingleChange"}),z.DefineIcon("removeLast",{NAME:"remove-last",SVG_KEY:"rejectSingleChange"}),z.RegisterCommand("trackChanges",{type:"button",title:"Enable Track Changes",plugin:"track_changes",showOnMobile:!0,callback:function(){this.track_changes.toggleTracking()},refreshAfterCallback:!0,forcedRefresh:!0,refresh:function(e){if(e&&this.$tb){var t=this.$tb.find('.fr-more-toolbar[data-name="'.concat(e.attr("id"),'"]')),a=0!==t.length&&t.hasClass("fr-expanded");(this.opts.trackChangesEnabled&&this.opts.toolbarContainer&&!a||!this.opts.trackChangesEnabled&&this.opts.toolbarContainer&&a)&&(this.$tb.find('.fr-more-toolbar[data-name="'.concat(e.attr("id"),'"]')).toggleClass("fr-expanded"),this.$box.toggleClass("fr-toolbar-open"),this.$tb.toggleClass("fr-toolbar-open"),e.toggleClass("fr-open")),e.toggleClass("fr-active",this.opts.trackChangesEnabled).attr("aria-pressed",this.opts.trackChangesEnabled)}}}),z.RegisterCommand("showChanges",{type:"button",icon:"showChanges",title:"Show Changes",plugin:"track_changes",undo:!1,focus:!1,accessibilityFocus:!0,forcedRefresh:!0,refreshAfterCallback:!0,toggle:!0,callback:function(){this.track_changes.showChanges()},refresh:function(e){e.toggleClass("fr-active",this.opts.showChangesEnabled).attr("aria-pressed",this.opts.showChangesEnabled)}}),z.RegisterCommand("applyAll",{type:"button",icon:"applyAll",title:"Accept All Changes",plugin:"track_changes",toggle:!0,refreshAfterCallback:!0,forcedRefresh:!0,callback:function(){0<this.track_changes.getPendingChanges().length&&this.track_changes.acceptAllChanges()},refresh:function(e){this.opts.trackChangesEnabled&&this.track_changes.refresh(e)}}),z.RegisterCommand("removeAll",{type:"button",icon:"removeAll",title:"Reject All Changes",plugin:"track_changes",toggle:!0,refreshAfterCallback:!0,forcedRefresh:!0,callback:function(){0<this.track_changes.getPendingChanges().length&&this.track_changes.rejectAllChanges()},refresh:function(e){this.opts.trackChangesEnabled&&this.track_changes.refresh(e)}}),z.RegisterCommand("applyLast",{type:"button",icon:"applyLast",title:"Accept Single Change",plugin:"track_changes",toggle:!0,refreshAfterCallback:!0,forcedRefresh:!0,callback:function(){0<this.track_changes.getPendingChanges().length&&this.track_changes.acceptSingleChange()},refresh:function(e){this.opts.trackChangesEnabled&&this.track_changes.refresh(e)}}),z.RegisterCommand("removeLast",{type:"button",icon:"removeLast",title:"Reject Single Change",plugin:"track_changes",toggle:!0,refreshAfterCallback:!0,forcedRefresh:!0,callback:function(){0<this.track_changes.getPendingChanges().length&&this.track_changes.rejectSingleChange()},refresh:function(e){this.opts.trackChangesEnabled&&this.track_changes.refresh(e)}})});